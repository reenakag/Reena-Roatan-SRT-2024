---
title: "Quant-Qual-Correlational-Analysis"
format: html
---

```{r}
library(ggplot2)
library(dplyr)
library(tidymodels)
```

```{r}

library(readr)
QUAL_with_preg_score <- read_csv("arya copy of RStudio_GitHub Merged Data (QUAL) - Qual (1).csv")
QUAL_with_preg_score

```

```{r}
#| label: separate-group_no

QUAL_with_preg_score <- QUAL_with_preg_score |>
  mutate(grupo = str_extract(group_no, "[A-Z]+")) |>
  mutate(survey_number_non_decimal = as.integer(gsub("[^0-9]", "", group_no)))

joined_vax_cards <- joined_vax_cards |>
  mutate(grupo = str_extract(group, "[A-Z]+")) |>
  mutate(survey_number_decimal = as.numeric(str_extract(group, "[0-9.]+"))) |>
  mutate(survey_number_non_decimal = trunc(survey_number_decimal))


```

```{r}
#| label: join-vax-score-with-preg-score

vax_score_joins_preg_score <- left_join(joined_vax_cards, QUAL_with_preg_score, by = c("grupo", "survey_number_non_decimal"))

vax_score_joins_preg_score |>
  select(group, age_rounded, vax_score, grupo, survey_number_decimal, survey_number_non_decimal, group_no, colonia, preg_score) |>
  write.csv(file = "vax_and_preg_score.csv", row.names = FALSE)
```

```{r}
#| label: vax-score-vs-preg-score

removed_preg_score_NA <- vax_score_joins_preg_score |>
  filter(!is.na(preg_score)) 

removed_preg_score_NA |>
  ggplot(
    aes(x = preg_score, y = vax_score)
  ) +
  geom_point() +
  scale_y_continuous(limits = c(0, 1.25)) +
  geom_smooth(method = "lm", se = FALSE) +
  theme_minimal() +
  labs(title = "Child Vaccination Status vs. Respondent Vaccine Knowledge",
       subtitle = "(for children with vaccine cards)",
       x = "Respondent Question Response Score",
       y = "Child Vaccination Score",
       caption = "n = 265")
#ggsave("Child Vaccination Status vs. Respondent Vaccine Knowledge.png")

vax_status_vs_preg_score_model <- linear_reg() |>
  set_engine("lm") |>
  fit(vax_score ~ preg_score, data = removed_preg_score_NA) |>
  tidy()


#correlation <- cor(removed_preg_score_NA$preg_score, removed_preg_score_NA$vax_score)
#print(correlation)
```

```{r}
#| label: vax-score-vs-preg-score-color-by-fam


removed_preg_score_NA |>
  ggplot(
    aes(x = preg_score, y = vax_score, color = group_no)
  ) +
  geom_point() +
  scale_y_continuous(limits = c(0, 1.25)) +
  theme_minimal() +
  labs(title = "Child Vaccination Status vs. Respondent Vaccine Knowledge",
       subtitle = "(for children with vaccine cards)",
       x = "Question Response Score",
       y = "Vaccination Score",
       caption = "(dots of the same color represent children of the same respondent)") +
  theme(legend.position = "none") +
  theme(plot.caption = element_text(size = 5))
#ggsave("Child Vaccination Status vs. Respondent Vaccine Knowledge (by family).png")

```


```{r}
#| label: vax-score-vs-preg-score-colonia-vs-not

removed_preg_score_NA |>
  ggplot(
    aes(x = preg_score, y = vax_score, color = colonia)
  ) +
  geom_point() +
  scale_y_continuous(limits = c(0, 1.25)) +
  geom_smooth(method = "lm", aes(group = colonia), se = FALSE) +
  theme_minimal() +
  labs(title = "Child Vaccination Status vs. Respondent Vaccine Knowledge",
       subtitle = "(for children with vaccine cards)",
       x = "Question Response Score",
       y = "Vaccination Score",
       color = "La Colonia") 
#ggsave("Child Vaccination Status vs. Respondent Vaccine Knowledge (Colonia).png")
```

```{r}
#| label: vax-score-vs-age

removed_preg_score_NA |>
  ggplot(
    aes(x = age_rounded, y = vax_score)
  ) +
  geom_point() +
  scale_y_continuous(limits = c(0, 1.25)) +
  geom_smooth(method = "lm", se = FALSE) +
  theme_minimal() +
  labs(title = "Child Vaccination Status vs. Child Age",
       subtitle = "(for children with vaccine cards)",
       x = "Child Age",
       y = "Vaccination Score")
#ggsave("Child Vaccination Status vs. Child Age.png")


```

```{r}
#| label: vax-score-vs-last-grade

removed_preg_score_NA |>
  ggplot(
    aes(x = last_grade, y = vax_score)
  ) +
  geom_point() +
  scale_y_continuous(limits = c(0, 1.25)) +
  geom_smooth(method = "lm", se = FALSE) +
  theme_minimal() +
  labs(title = "Child Vaccination Status vs. Respondent's Education Level",
       subtitle = "(for children with vaccine cards)",
       x = "Respondent's Last Grade of School Completed",
       y = "Vaccination Score")
#ggsave("Child Vaccination Status vs. Respondent's Education Level.png")

```

```{r}
#| label: vax-score-colonia-vs-not


#removed_preg_score_NA |>
 # group_by(colonia) |>
 # mutate(mean_vax_score = mean(vax_score)) |>
 # ggplot(
 #   aes(x = colonia, y = mean_vax_score)
 # ) +
#  geom_col()

#mean_values <- aggregate(vax_score ~ colonia, data = removed_preg_score_NA, FUN = mean)

removed_preg_score_NA |>
  ggplot(
    aes(x = colonia, y = vax_score, color = colonia)
  ) +
  geom_boxplot() +
  theme_minimal() +
  theme(legend.position = "none") +
  labs(title = "Distribution of Child Vaccination Scores in La Colonia vs. Not",
       subtitle = "(for children with vaccine cards)",
       x = "La Colonia",
       y = "Child Vaccination Score") 
#ggsave("Distribution of Child Vaccination Scores in La Colonia vs. Not.png")
```



