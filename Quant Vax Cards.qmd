---
title: "Quant Vax Cards"
format: html
---

```{r}
library(tidyverse)
library(lubridate)
library(readxl)
library(googlesheets4)
library(broom)
```


```{r}
library(readr)
QUANT_vax_cards <- read_csv("QUANT_vax_cards.csv", 
    col_types = cols(date = col_date(format = "%d-%m-%y")))
View(QUANT_vax_cards)
```

```{r}
#| label: gender

# frequency table
QUANT_vax_cards |>
  count(gender) |>
  mutate(prop = n/sum(n))

# bar chart
QUANT_vax_cards |> ggplot(
  aes(x = gender, fill = gender)
) +
  geom_bar() +
  labs(title = "Genders of Children Accounted For", subtitle = "with Vaccine Cards")

# pie chart
slices <- c(122, 132, 16)
labels <- c("Female", "Male", "Unknown")
percent <- round(slices/sum(slices)*100)
labels <- paste(labels, percent)
labels <- paste(labels,"%",sep="") 
pie(slices, labels = labels, col = rainbow(length(labels)), main = "Pie Chart of Genders Survyed (with Vaccine Cards)")
  
```

```{r}
#| label: date format

dob_date_format_tibble <- QUANT_vax_cards |>
  select(dob, dob_date_format) |>
  mutate(day = day(dob_date_format),
         month = month(dob_date_format),
         year = year(dob_date_format))

dob_date_format_tibble
```

```{r}
#| label: adding-vax-score

vax_score_tibble <- QUANT_vax_cards |>
  mutate(date_of_survey = as.Date(date)) |>
  select(date_of_survey, gender, dob, dob_date_format) 
  
  #mutate(dob_day = day(dob_date_format),
  #       dob_month = month(dob_date_format),
  #       dob_year = year(dob_date_format))


vax_score_tibble <- vax_score_tibble |>
  mutate(age_in_days = date_of_survey - dob_date_format) |>
  mutate(age_in_years = as.numeric(age_in_days) / 365.25) |>
  mutate(age_rounded = round(age_in_years, 1))


vax_score_tibble <- vax_score_tibble |>
  mutate(desired_vax_score = if_else(age_rounded < 0.2, 2, 
                              if_else(age_rounded >= 0.2 & age_rounded < 0.3, 5,
                               if_else(age_rounded >= 0.3 & age_rounded < 0.5, 8,
                                if_else(age_rounded >= 0.5 & age_rounded < 1.0, 11, 
                                 if_else(age_rounded >= 1.0 & age_rounded < 1.5, 13,
                                  if_else(age_rounded >= 1.5 & age_rounded < 4, 14,
                                   if_else(age_rounded >= 4 & age_rounded < 5, 15,
                                    if_else(age_rounded >= 5 & age_rounded < 11, 16,
                                     if_else(age_rounded >= 11 & gender == "M", 17,
                                      if_else(age_rounded >= 11 & gender == "F", 18, 0)))))))))))

vax_score_tibble <- vax_score_tibble |>
  select(dob_date_format, age_rounded, desired_vax_score) 
vax_score_tibble         
           
#case_when(
#    age_rounded < 0.2 ~ 2
#    age_rounded >= 0.2 && age_rounded < 0.3 ~ 5
#    age_rounded >= 0.3 && age_rounded < 0.5 ~ 8
#    age_rounded >= 0.5 && age_rounded < 1.0 ~11
#    TRUE ~0


```

