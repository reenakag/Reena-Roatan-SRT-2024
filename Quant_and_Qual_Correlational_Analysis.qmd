---
title: "Quant-Qual-Correlational-Analysis"
format: html
---

```{r}
library(ggplot2)
library(dplyr)
library(tidymodels)
```

```{r}

library(readr)
QUAL_with_preg_score <- read_csv("arya copy of RStudio_GitHub Merged Data (QUAL) - Qual (1).csv")
QUAL_with_preg_score

```

```{r}
#| label: separate-group_no

QUAL_with_preg_score <- QUAL_with_preg_score |>
  mutate(grupo = str_extract(group_no, "[A-Z]+")) |>
  mutate(survey_number_non_decimal = as.integer(gsub("[^0-9]", "", group_no)))

joined_vax_cards <- joined_vax_cards |>
  mutate(grupo = str_extract(group, "[A-Z]+")) |>
  mutate(survey_number_decimal = as.numeric(str_extract(group, "[0-9.]+"))) |>
  mutate(survey_number_non_decimal = trunc(survey_number_decimal))


```

```{r}
#| label: join-vax-score-with-preg-score

vax_score_joins_preg_score <- left_join(joined_vax_cards, QUAL_with_preg_score, by = c("grupo", "survey_number_non_decimal"))

vax_score_joins_preg_score |>
  select(group, age_rounded, vax_score, grupo, survey_number_decimal, survey_number_non_decimal, group_no, colonia, preg_score) |>
  write.csv(file = "vax_and_preg_score.csv", row.names = FALSE)
```

```{r}
#| label: vax-score-vs-preg-score

removed_preg_score_NA <- vax_score_joins_preg_score |>
  filter(!is.na(preg_score)) 

removed_preg_score_NA |>
  ggplot(
    aes(x = preg_score, y = vax_score)
  ) +
  geom_point() +
  scale_y_continuous(limits = c(0, 1.25)) +
  geom_smooth(method = "lm", se = FALSE) +
  theme_minimal() +
  labs(title = "Child Vaccination Status vs. Respondent Vaccine Knowledge",
       subtitle = "(for children with vaccine cards)",
       x = "Respondent Question Response Score",
       y = "Child Vaccination Score",
       caption = "n = 265")
ggsave("Child Vaccination Status vs. Respondent Vaccine Knowledge.png")

```

```{r}
#| label: vax-status-vs-preg-score-model

model1 <- lm(vax_score ~ preg_score, data = removed_preg_score_NA)

summary(model1)

print("equation of line of best fit:  vax score = 0.7917 + 0.0228*response score")

#calc r
predicted_values <- predict(model1)  
observed_values <- removed_preg_score_NA$vax_score  
cor1 <- cor(predicted_values, observed_values)
print(cor1)

#calc rsquared
rsq1 <- summary(model1)$adj.r.squared
print(rsq1)

```


```{r}
#| label: vax-score-vs-preg-score-color-by-fam


removed_preg_score_NA |>
  ggplot(
    aes(x = preg_score, y = vax_score, color = group_no)
  ) +
  geom_point() +
  scale_y_continuous(limits = c(0, 1.25)) +
  theme_minimal() +
  labs(title = "Child Vaccination Status vs. Respondent Vaccine Knowledge",
       subtitle = "(for children with vaccine cards)",
       x = "Question Response Score",
       y = "Vaccination Score",
       caption = "(dots of the same color represent children of the same respondent)") +
  theme(legend.position = "none") +
  theme(plot.caption = element_text(size = 5))
#ggsave("Child Vaccination Status vs. Respondent Vaccine Knowledge (by family).png")

```


```{r}
#| label: vax-score-vs-preg-score-colonia-vs-not

removed_preg_score_NA |>
  ggplot(
    aes(x = preg_score, y = vax_score, color = colonia)
  ) +
  geom_point() +
  scale_y_continuous(limits = c(0, 1.25)) +
  geom_smooth(method = "lm", aes(group = colonia), se = FALSE) +
  theme_minimal() +
  labs(title = "Child Vaccination Status vs. Respondent Vaccine Knowledge",
       subtitle = "(for children with vaccine cards)",
       x = "Respondent Question Response Score",
       y = "Child Vaccination Score",
       color = "La Colonia",
       caption = "n = 265") 
ggsave("Child Vaccination Status vs. Respondent Vaccine Knowledge (Colonia).png")
```

```{r}
#| label: vax-score-vs-preg-score-colonia-model

#additive model
model2 <- lm(vax_score ~ preg_score + colonia, data = removed_preg_score_NA)

summary(model2)

print("equation of non-Colonia line of best fit:  vax score = 0.7720 + 0.0261*response score 
      equation of Colonia line of best fit: vax score = 0.7986 + 0.0218*response score 
      equation of LSRL of model: vax score = 0.7720 + 0.0235*response score + 0.0266*colonia")

#calc r
predicted_values <- predict(model2)  
observed_values <- removed_preg_score_NA$vax_score  
cor2 <- cor(predicted_values, observed_values)
print(cor2)

#calc rsquared
rsq2 <- summary(model2)$adj.r.squared
print(rsq2)

```


```{r}
#| label: vax-score-vs-age

vax_score_joins_preg_score |>
  ggplot(
    aes(x = age_rounded, y = vax_score)
  ) +
  geom_point() +
  scale_y_continuous(limits = c(0, 1.25)) +
  geom_smooth(method = "lm", se = FALSE) +
  theme_minimal() +
  labs(title = "Child Vaccination Status vs. Child Age",
       subtitle = "(for children with vaccine cards)",
       x = "Child Age",
       y = "Child Vaccination Score",
       caption = "n = 270")
ggsave("Child Vaccination Status vs. Child Age.png")


```

```{r}
#| label: vax-score-vs-age-model

model3 <- lm(vax_score ~ age_rounded, data = removed_preg_score_NA)

summary(model3)

print("equation of line of best fit:  vax score = 0.9349 + -0.0051*child age")

#calc r
predicted_values <- predict(model3)  
observed_values <- removed_preg_score_NA$vax_score  
cor3 <- cor(predicted_values, observed_values)
print(cor3)

#calc rsquared
rsq3 <- summary(model3)$adj.r.squared
print(rsq3)

```


```{r}
#| label: vax-score-vs-last-grade

removed_preg_score_NA |>
  ggplot(
    aes(x = last_grade, y = vax_score)
  ) +
  geom_point() +
  scale_y_continuous(limits = c(0, 1.25)) +
  geom_smooth(method = "lm", se = FALSE) +
  theme_minimal() +
  labs(title = "Child Vaccination Status vs. Respondent's Education Level",
       subtitle = "(for children with vaccine cards)",
       x = "Respondent's Last Grade of School Completed",
       y = "Child Vaccination Score", 
       caption = "n = 257")
ggsave("Child Vaccination Status vs. Respondent's Education Level.png")

```

```{r}
#| label: vax-score-vs-education-model

removed_last_grade_NA <- removed_preg_score_NA |>
  filter(!is.na(last_grade))

model4 <- lm(vax_score ~ last_grade, data = removed_last_grade_NA)

summary(model4)

print("equation of line of best fit:  vax score = 0.9278 + -0.0016*last grade")

#calc r
predicted_values <- predict(model4)  
observed_values <- removed_last_grade_NA$vax_score  
cor4 <- cor(predicted_values, observed_values)
print(cor4)

#calc rsquared
rsq4 <- summary(model4)$adj.r.squared
print(rsq4)
```


```{r}
#| label: vax-score-colonia-vs-not

removed_preg_score_NA |>
  ggplot(
    aes(x = colonia, y = vax_score, color = colonia)
  ) +
  geom_boxplot() +
  scale_y_continuous(limits = c(0, 1.1)) +
  theme_minimal() +
  theme(legend.position = "none") +
  labs(title = "Distribution of Child Vaccination Scores in La Colonia vs. Non-Colonia",
       subtitle = "(for children with vaccine cards)",
       x = "La Colonia",
       y = "Child Vaccination Score",
       caption = "n = 270") 
ggsave("Distribution of Child Vaccination Scores in La Colonia vs. Non-Colonia.png")

vax_score_joins_preg_score_colonia <- vax_score_joins_preg_score |>
  filter(colonia == "Yes") 
  
mean_vax_score_colonia = mean(vax_score_joins_preg_score_colonia$vax_score)
print(mean_vax_score_colonia)

vax_score_joins_preg_score_non_colonia <- vax_score_joins_preg_score |>
  filter(colonia == "No") 
  
mean_vax_score_non_colonia = mean(vax_score_joins_preg_score_non_colonia$vax_score)
print(mean_vax_score_non_colonia)
```



